angular.module("anguprofile",[]).directive("anguprofile",function(a,b){return{restrict:"EA",scope:{id:"@imgid",imgSrc:"@imgsrc",imgClass:"@imgclass",uploadUrl:"@uploadurl"},template:'<img class="{{imgClass}}" id="{{id}}" ng-src="{{imgSrc}}" ng-click="fileUploadClick()"/><input type="file" id="fileuploader_{{id}}" ng-model-instant style="display: none;"/>',controller:function(c){c.blah=function(d){console.log("in blah")};c.uploadFromClick=function(d){console.log(d.srcElement.files);c.handleFiles(d.srcElement.files)};c.fileUploadClick=function(){$("#fileuploader_"+c.id).click()};c.handleFiles=function(g){$("#"+c.id).addClass("anguprofile-uploading");var f;for(var e=0;f=g[e];e++){if(true){var d=new FileReader();d.onload=(function(h){return function(i){$("#"+c.id).attr("src",i.target.result)}}(f));d.readAsDataURL(f)}c.resizeAndUpload(f)}};c.fileSelect=function(d){d.stopPropagation();d.preventDefault();if(window.File&&window.FileReader&&window.FileList&&window.Blob){var e=d.dataTransfer.files;c.handleFiles(e)}else{alert("The File APIs are not fully supported in this browser.")}};c.dragOver=function(d){d.stopPropagation();d.preventDefault();d.dataTransfer.dropEffect="copy"};c.resizeAndUpload=function(e){var d=new FileReader();d.onloadend=function(){var f=new Image();f.src=d.result;f.onload=function(){var j=500;var m=500;var i=f.width;var l=f.height;if(i>l){if(i>j){l*=j/i;i=j}}else{if(l>m){i*=m/l;l=m}}var h=document.createElement("canvas");h.width=i;h.height=l;var g=h.getContext("2d");g.drawImage(this,0,0,i,l);var k=h.toDataURL("image/jpeg");$.post(c.uploadUrl,{image:k},function(n){c.imgSrc=c.imgSrc+"?id="+new Date().getMilliseconds();c.$apply();$("#"+c.id).removeClass("anguprofile-uploading")})}};d.readAsDataURL(e)}},link:function(c,e,d){e[0].firstChild.addEventListener("dragover",c.dragOver,false);e[0].firstChild.addEventListener("drop",c.fileSelect,false);e[0].children[1].addEventListener("change",c.uploadFromClick,false)}}});