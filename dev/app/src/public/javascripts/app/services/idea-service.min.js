angular.module("ideaservice",[]).service("IdeaService",function(b,e){var c=600000;var a={};var d=function(j,h){if(!j&&!h){return true}if(!j&&h){return false}if(!h&&j){return false}if(j.length!==h.length){return false}for(var g=0,f=j.length;g<f;g++){if(j[g] instanceof Array&&h[g] instanceof Array){if(!j[g].compare(h[g])){return false}}else{if(j[g]!==h[g]){return false}}}return true};this.loadIdeasForBoard=function(l,f,k){var h=new Date().getTime();var j=true;if(a[l]&&a[l].timestamp>h-c){var i=a[l];var g=d(i.selectedSessions,f);j=!g;if(!j){k(null,i.ideas)}}if(j){a[l]=null;e.post("/api/idea-boards/"+l+"/all",{selectedSessions:f}).success(function(o,m,p,n){if(o.status&&o.status==="ok"){a[l]={timestamp:new Date().getTime(),ideas:o.data,selectedSessions:f.slice()};k(null,o.data)}else{k(o,null)}}).error(function(o,m,p,n){k(o)})}};this.loadNewIdeasForBoard=function(j,g,i){var f=a[j];var h=[];if(!f){loadIdeasForBoard(j,g,i)}else{if(f.ideas&&f.ideas.length>=0){postWithErrorHandling(e,"/api/idea-boards/"+j+"/all",{since:f.ideas[0].creationDate,selectedSessions:g},"Could not refresh",function(o,n){if(!o&&n&&n.length>0){for(var m=0;m<n.length;m++){var l=n[m];l.tempId=l._id;l.pulse=true;var p=false;for(var k=0;k<f.ideas.length;k++){if(f.ideas[k]._id===l._id){p=true;break}}if(!p){n.unshift(l);f.ideas.unshift(l)}}i(null,n)}else{if(o){i(o,null)}}})}}}});