ideafunnelMainApp.controller("BoardMembersController",["$scope","$http","$location","localStorageService","$routeParams",function(a,f,e,d,c){$("body").scrollTop(0);a.boardMembers=[];a.selectedUser={};a.username=username;getWithErrorHandling(f,"/api/idea-boards/view/"+c.boardId,"Could not load board",function(k,j){a.board=j;a.$emit("selectedBoard",j);a.boardMembers=j.members;var h=[],g;for(g=0;g<a.boardMembers.length;g++){h.push(a.boardMembers[g].userId)}a.adminOfBoard=false;for(g=0;g<a.board.members.length;g++){if(a.board.members[g].userId===username){if(a.board.members[g].admin){a.adminOfBoard=true}break}}postWithErrorHandling(f,"/api/users/names",{usernames:h},"Could not retrieve users' names",function(o,p){if(!o){for(var n=0;n<p.length;n++){for(var l=0;l<a.board.members.length;l++){if(a.board.members[l].userId===p[n]._id){a.board.members[l].firstName=p[n].firstName;a.board.members[l].surname=p[n].surname;break}}}}})});var b=function(g){setTimeout(function(){for(var h=0;h<a.board.members.length;h++){if(a.board.members[h]._id===g){a.board.members[h].pulse=false;break}}},1000)};a.removeMemberFromBoard=function(h){var g=a.board.members[h].userId;a.board.members.splice(h,1);postWithErrorHandling(f,"/api/idea-boards/"+a.board._id+"/members/remove",{userId:g},"Could not remove user",function(j,i){})};a.updateMemberRights=function(g){g.admin=!g.admin;postWithErrorHandling(f,"/api/idea-boards/"+a.board._id+"/members/add",{userId:g.userId,admin:g.admin},"Could not update user rights",function(i,h){})};a.addMemberToBoard=function(g){var j=false;for(var h=0;h<a.board.members.length;h++){if(g.originalObject._id===a.board.members[h].userId){j=true;a.board.members[h].pulse=true;b(a.board.members[h].userId);break}}if(!j){g.originalObject.pulse=true;g.originalObject.userId=g.originalObject._id;a.board.members.splice(0,0,g.originalObject);b(a.board.members[a.board.members.length-1].userId);postWithErrorHandling(f,"/api/idea-boards/"+a.board._id+"/members/add",{userId:a.selectedUser.originalObject._id,admin:false},"Could not add user to board",function(k,i){})}};a.$watch("selectedUser",function(g){if(g&&g.originalObject){a.addMemberToBoard(g);a.selectedUser=null}})}]);