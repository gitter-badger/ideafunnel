ideafunnelMainApp.controller("QualificationCriteriaController",["$scope","$http","$location","localStorageService","$routeParams",function(a,e,d,c,b){a.$emit("navChange","boards");a.$emit("subNavChange","board-members");$("body").scrollTop(0);a.boardMembers=[];a.selectedUser={};a.username=username;a.showAddNew=false;a.newOption={show:false};a.criteria=[];a.options=[];a.editTitle=false;getWithErrorHandling(e,"/api/idea-boards/view/"+b.boardId,"Could not load board",function(h,g){a.board=g;a.criteria=g.criteria.reverse();a.adminOfBoard=false;for(var f=0;f<a.board.members.length;f++){if(a.board.members[f].userId===username){if(a.board.members[f].admin){a.adminOfBoard=true}break}}a.$emit("selectedBoard",g)});a.addNewCriterion=function(){if(a.addCriteriaTitle&&a.addCriteriaTitle!==""){postWithErrorHandling(e,"/api/idea-boards/"+a.board._id+"/criteria/add",{title:a.addCriteriaTitle},"Could not update board",function(g,f){if(!g){a.board=f;a.criteria=a.board.criteria.reverse();a.showEditOptionsDialog(a.criteria[0])}a.addCriteriaTitle=""})}};a.showAddNewOption=function(){a.newOption.show=true;var g=$("#newOptionTitle").val("");var f=$("#newOptionScore").val("0")};a.saveNewOption=function(h){a.newOption={show:false};var g=$("#newOptionTitle").val();var f=$("#newOptionScore").val();postWithErrorHandling(e,"/api/idea-boards/"+a.board._id+"/criteria/"+a.selectedCriterion._id+"/options/add",{title:g,weighting:f},"Error adding option",function(l,j){if(!l){a.board=j;a.criteria=j.criteria.reverse();for(var k=0;k<j.criteria.length;k++){if(j.criteria[k]._id===a.selectedCriterion._id){a.sortAndSetOptionsArray(j.criteria[k].choices);return}}}})};a.sortOptionsArray=function(f){f.sort(function(h,g){if(g.weighting&&h.weighting){return g.weighting-h.weighting}else{if(!h.weighting){return 1}else{if(!g.weighting){return -1}}}});return f};a.sortAndSetOptionsArray=function(f){a.options=f;a.sortOptionsArray(a.options)};a.deleteOption=function(f){postWithErrorHandling(e,"/api/idea-boards/"+a.board._id+"/criteria/"+a.selectedCriterion._id+"/options/remove",{optionId:f._id},"Could not remove option",function(j,g){if(!j){a.board=g;a.criteria=g.criteria.reverse();for(var h=0;h<g.criteria.length;h++){if(g.criteria[h]._id===a.selectedCriterion._id){a.sortAndSetOptionsArray(g.criteria[h].choices);return}}}})};a.deleteCriterion=function(f){postWithErrorHandling(e,"/api/idea-boards/"+a.board._id+"/criteria/"+f._id+"/remove",{},"Could not remove criterion",function(h,g){if(!h){a.board=g;a.criteria=g.criteria.reverse()}})};a.editOption=function(f){f.edit=true};a.hideAddOption=function(){a.addOptionTitle="";a.addOptionScore="";a.newOption={show:false}};a.cancelEditOption=function(f){f.edit=false;$("#editOptionTitle_"+f._id).val(f.title);$("#editOptionScore_"+f._id).val("0")};a.saveEditOption=function(f){f.edit=false;var h=$("#editOptionTitle_"+f._id).val();var g=$("#editOptionScore_"+f._id).val();postWithErrorHandling(e,"/api/idea-boards/"+a.board._id+"/criteria/"+a.selectedCriterion._id+"/options/edit",{optionId:f._id,title:h,weighting:g},"Could not update option",function(l,j){if(!l){a.board=j;a.criteria=j.criteria.reverse();for(var k=0;k<j.criteria.length;k++){if(j.criteria[k]._id===a.selectedCriterion._id){a.sortAndSetOptionsArray(j.criteria[k].choices);return}}}})};a.showEditOptionsDialog=function(g){a.selectedCriterion=g;a.sortAndSetOptionsArray(a.selectedCriterion.choices);a.addOptionTitle="";a.addOptionScore="";a.newOption={show:false};if(a.options&&a.options.length>0){for(var f=0;f<a.options.length;f++){a.options[f].edit=false}}$("#editOptions").modal()};a.showEditTitle=function(){a.editTitle=true};a.cancelEditTitle=function(){a.editTitle=false};a.saveEditTitle=function(){var f=$("#newTitle").val();if(!f||f.trim()===""){handleError("No title specified")}else{postWithErrorHandling(e,"/api/idea-boards/"+a.board._id+"/criteria/"+a.selectedCriterion._id+"/edit",{title:f},"Could not update criterion",function(j,g){if(!j){a.board=g;a.criteria=g.criteria.reverse();for(var h=0;h<g.criteria.length;h++){if(g.criteria[h]._id===a.selectedCriterion._id){a.selectedCriterion=g.criteria[h];a.sortAndSetOptionsArray(g.criteria[h].choices);break}}}});a.editTitle=false}}}]);