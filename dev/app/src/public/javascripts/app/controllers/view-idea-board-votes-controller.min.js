ideafunnelApp.controller("ViewIdeaBoardVotesController",["$scope","$http","$location",function(b,f){var c=2000;var d=5000;var e=500;var a=4000;b.criteria=[];b.ideas=[];b.rankings=[];b.showNow=[false,false,false];b.currentCriteriaIndex=0;b.initIdeaBoard=function(h,g){b.ideaBoardId=h;b.username=g;getWithErrorHandling(f,"/api/idea-boards/view/"+h,"Could not retrieve board",function(j,i){b.ideaBoard=i;b.criteria=i.criteria;getWithErrorHandling(f,"/api/idea-boards/"+h+"/all","Could not load ideas",function(l,k){b.ideas=k;b.moveToCriteria(b.criteria[0])})})};b.showNextPosition=function(){b.showNow[b.currentPosition]=true;b.$apply();b.currentPosition--;if(b.currentPosition>=0){setTimeout(function(){b.showNextPosition()},c)}else{b.currentCriteriaIndex++;if(b.currentCriteriaIndex>=b.criteria.length){b.currentCriteriaIndex=0}setTimeout(function(){b.moveToCriteria(b.criteria[b.currentCriteriaIndex])},d);setTimeout(function(){$("#mainArea").addClass("animated fadeOut")},a)}};b.moveToCriteria=function(g){$("#mainHeading").removeClass("animated slideInDown");$("#mainHeading").hide();setTimeout(function(){$("#mainHeading").show();$("#mainHeading").addClass("animated slideInDown");$("#mainArea").removeClass("animated fadeOut")},e);getWithErrorHandling(f,"/api/idea-boards/"+b.ideaBoardId+"/votes/criteria/"+g._id,"Could not retrieve criteria scores",function(l,m){b.selectedCriterion=g;b.rankings=[];b.showNow=[false,false,false];if(m){var k=m.results;for(var j=0;j<k.length&&j<3;j++){for(var h=0;h<b.ideas.length;h++){if(b.ideas[h]._id===k[j].ideaId){b.rankings[j]={idea:b.ideas[h],score:k[j].totalScore};break}}}}b.currentPosition=b.rankings.length-1;setTimeout(function(){b.showNextPosition()},c)})}}]);