ideafunnelMainApp.controller("ViewIdeaController",["$scope","$http","$location","localStorageService","$routeParams","$rootScope",function(b,g,f,e,d,a){var c=12;$("body").scrollTop(0);b.$emit("nav-size","large");b.tab="info";b.idea=null;b.ideaId=d.ideaId;b.ideaBoardId=d.boardId;b.ideaIdList=[];b.qualifyOptions={};b.username=username;e.add("lastIdeaInBoard",b.ideaBoardId);e.add("lastIdeaId",b.ideaId);if(e.get("ideaList")){b.ideaIdList=e.get("ideaList")}if(e.get("defaultIdeaTab")){b.tab=e.get("defaultIdeaTab")}b.showPreviousCard=function(){if(b.ideaIdList&&b.ideaIdList.length>0&&b.idea){var j=null;for(var h=0;h<b.ideaIdList.length;h++){if(b.ideaIdList[h]===b.idea._id){if(h-1>=0){j=b.ideaIdList[h-1]}else{j=b.ideaIdList[b.ideaIdList.length-1]}b.idea=null;f.path("/boards/"+b.ideaBoardId+"/"+j);return}}}};b.changeTab=function(h){e.add("defaultIdeaTab",h);b.tab=h};b.showNextCard=function(){if(b.ideaIdList&&b.ideaIdList.length>0&&b.idea){var j=null;for(var h=0;h<b.ideaIdList.length;h++){if(b.ideaIdList[h]===b.idea._id){if(h+1<b.ideaIdList.length){j=b.ideaIdList[h+1]}else{j=b.ideaIdList[0]}b.idea=null;f.path("/boards/"+b.ideaBoardId+"/"+j);return}}}};b.deleteCard=function(){var h=b.idea,j;for(j=0;j<b.ideaIdList.length;j++){if(b.ideaIdList[j]._id===h._id){b.ideaIdList.splice(j,1);break}}if(b.ideaIdList.length===0){b.closeFullScreen()}else{b.showNextCard()}if(a.ideaCache&&a.ideaCache[b.ideaBoardId]&&a.ideaCache[b.ideaBoardId].ideas){for(j=0;j<a.ideaCache[b.ideaBoardId].ideas.length;j++){if(a.ideaCache[b.ideaBoardId].ideas[j]._id===h._id){a.ideaCache[b.ideaBoardId].ideas.splice(j,1);break}}}postWithErrorHandling(g,"/api/idea-boards/"+b.ideaBoardId+"/"+h._id+"/delete",{},"Could not delete idea",function(i,k){})};b.closeFullScreen=function(){$(window).keyup=undefined;f.path("/boards/"+b.ideaBoardId)};b.getBackgroundImageForCard=function(h){if(h&&h.hasImage){return"background-image: url('/card_images/"+h._id+".jpg'); background-size: cover; background-position: center;"}else{return""}};$(window).on("keyup",function(h){if(h.keyCode===37){b.showPreviousCard();h.preventDefault();h.stopPropagation();b.$apply()}else{if(h.keyCode===39){b.showNextCard();h.preventDefault();h.stopPropagation();b.$apply();return false}else{if(h.keyCode===27){b.closeFullScreen();h.preventDefault();h.stopPropagation();b.$apply()}}}});b.$on("$destroy",function(){$(window).off("keyup");b.idea=null;b.$emit("nav-size","small")});b.$on("$routeChangeStart",function(h,i){$(window).off("keyup")});b.lookupQualificationTitle=function(l,k){if(b.board.criteria&&b.board.criteria.length>0){for(var j=0;j<b.board.criteria.length;j++){if(b.board.criteria[j]._id===l){for(var h=0;h<b.board.criteria[j].choices.length;h++){if(b.board.criteria[j].choices[h]._id===k){return b.board.criteria[j].choices[h].title}}}}}return""};b.updateQualificationOptions=function(){var j={};if(b.idea.qualifications&&b.idea.qualifications.length>0){for(var h=0;h<b.idea.qualifications.length;h++){if(b.idea.qualifications[h].userId===b.username){j[b.idea.qualifications[h].criteriaId]={id:b.idea.qualifications[h].optionId,title:b.lookupQualificationTitle(b.idea.qualifications[h].criteriaId,b.idea.qualifications[h].optionId)}}}}b.qualifyOptions=j};b.rightClickCard=function(){console.log("Right clicked")};getWithErrorHandling(g,"/api/idea-boards/"+d.boardId+"/"+d.ideaId+"/view","Could not load idea",function(k,j){b.idea=j;b.board=j.board;b.adminOfBoard=false;for(var h=0;h<b.board.members.length;h++){if(b.board.members[h].userId===username){if(b.board.members[h].admin){b.adminOfBoard=true}break}}b.updateQualificationOptions();b.generateGraph()});b.getPercentage=function(h){if(!h||h===0){return"0%"}else{return Math.round(h*100)+"%"}};b.$on("qualificationScoreUpdated",function(h,i){b.idea.qualificationScore=i.newQualificationScore;$(".qualification-score-card").addClass("animated pulse");setTimeout(function(){$(".qualification-score-card").removeClass("animated pulse")},1000)});b.qualifyIdeaWithOption=function(i,h){b.qualifyOptions[i._id]={id:h._id,title:h.title};postWithErrorHandling(g,"/api/idea-boards/"+b.board._id+"/qualify/"+b.idea._id,{criterionId:i._id,optionId:h._id},"Could not qualify idea",function(k,j){b.idea.qualificationScore=j.totalScore;b.idea.qualificationScorePercentage=j.totalScorePercentage;b.idea.qualificationCategoryScores=j.categories;b.generateGraph();$(".qualification-score-card").addClass("animated pulse");setTimeout(function(){$(".qualification-score-card").removeClass("animated pulse")},1000)})};b.trimTitle=function(h){if(h.length>c){return h.substr(0,c)+"..."}else{return h}};b.generateGraph=function(){if(b.idea.board.criteria&&b.idea.board.criteria.length>1&&Object.keys(b.idea.qualificationCategoryScores).length>0){var q=100,l=100;var o=d3.scale.category10();var r=[""];var n=[[]];for(var j=0;j<b.idea.board.criteria.length;j++){var p=0;if(b.idea.qualificationCategoryScores[b.idea.board.criteria[j]._id]){n[0].push({axis:b.trimTitle(b.idea.board.criteria[j].title),value:b.idea.qualificationCategoryScores[b.idea.board.criteria[j]._id].percentageAvg})}else{n[0].push({axis:b.trimTitle(b.idea.board.criteria[j].title),value:0})}}var m={w:q,h:l,maxValue:1,levels:10,ExtraWidthX:150};RadarChart.draw("#chart",n,m);var k=d3.select("#chartHolder").selectAll("svg").append("svg").attr("width",q).attr("height",l)}}}]);