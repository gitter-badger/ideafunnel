ideafunnelMainApp.controller("CreateIdeaBoardController",["$scope","$http","$location",function(a,c,b){a.$emit("navChange","boards");a.board={};a.codeValid=false;a.board.allowAnonymous=true;a.board._id="";a.board.title="";a.board.description="";a.autogenerateId=function(){if(!a.board.title&&a.board.title.length===0){a.board.title="";return}var d=a.board.title.replace(/[^A-Z0-9_-]+/ig,"");if(d.length>30){d=d.substr(0,28)}d=d.toLowerCase();a.board._id=d;a.checkIdeaBoardCode()};a.checkCodeTimer=null;a.searchingForValidCode=false;a.checkIdeaBoardCode=function(){if(a.checkCodeTimer){clearTimeout(a.checkCodeTimer)}a.searchingForValidCode=true;a.errorMsg="";a.codeValid=true;if(a.board._id.trim().length<3||a.board._id.trim().length>30){a.codeValid=false;a.errorMsg="Board code must be between 3-30 characters"}if(new RegExp(/[A-Z]/).test(a.board._id.trim())){a.codeValid=false;if(a.errorMsg.length!==0){a.errorMsg+=", "}a.errorMsg+="Board code must contain lower case letters only"}if(!new RegExp(/^[a-zA-Z0-9-]*$/).test(a.board._id)){a.codeValid=false;if(a.errorMsg.length!==0){a.errorMsg+=", "}a.errorMsg+="No special characters(!,|.&) or spaces allowed"}if(!a.codeValid){a.searchingForValidCode=false;return}a.checkCodeTimer=setTimeout(function(){c.get("/api/idea-boards/check-code?code="+a.board._id).success(function(d){if(d.status&&d.status==="ok"){a.codeValid=true}else{a.codeValid=false;a.errorMsg=d.error}a.searchingForValidCode=false}).error(function(d){handleError("Could not check code",d);a.searchingForValidCode=false})},300)};a.createNow=function(){if(a.board.title&&a.board._id&&a.board.description){a.creatingIdea=true;postWithErrorHandling(c,"/api/idea-boards/create",a.board,"Could not create Idea Board",function(e,d){if(!e){b.path("/boards/"+d._id)}else{handleError(e)}a.creatingIdea=false})}else{a.missingFields=true;handleError("Please fill in all fields before you can proceed")}};a.cancel=function(){b.path("/boards")}}]);